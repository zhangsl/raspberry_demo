C51 COMPILER V9.00   DS1302Ê±_ÓÐ¾Æ¬ÊµÑé2                                                   01/01/2003 18:07:22 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE DS1302Ê±_ÓÐ¾Æ¬ÊµÑé2
OBJECT MODULE PLACED IN DS1302Ê±ÖÓÐ¾Æ¬ÊµÑé2.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE DS1302Ê±ÖÓÐ¾Æ¬ÊµÑé2.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          
   3          /***************************************************************************
   4          ÊµÑéÊ®¾Å:   DS1302Ê±ÖÓÐ¾Æ¬ÊµÑé
   5          ËµÃ÷:       ÒòÎªÖ»ÓÐËÄÎ»ÊýÂë¹Ü£¬
   6                      ÎªÁË·½±ã¿´µ½ÊµÑéÐ§ê½Ö»ÏÔÊ¾·ÖÓëÃë
   7          ÊµÑéÏÖÏó:   ÊýÂë¹ÜÉÏÏÔÊ¾·ÖÓëÃë 
   8          
   9          Á¬ÏßËµÃ÷:   1,½«ÊýÂë¹ÜµÄa-dot½Óµ½P0¿Ú             (Á¬½ÓÇë×¢ÒâË³Ðò)
  10                      2,½«ÊýÂë¹ÜµÄs1-s4½Óµ½P20-P24
  11                                  3,½«DS1302·Ö±ð½ÓÒÔÏÂÁ¬½Ó
  12                                    SCLK----------P10
  13                                    I/O ----------P11
  14                                    RST ----------P12
  15                    
  16          CPUÐÍºÅ:    AT89S52
  17          ÏµÍ³Ê±ÖÓ:   11.0592MHZ
  18          ±àÒë»·¾³:   keil uVision4
  19          ÈÕÆÚ£º      2009-8-2
  20          ÁªÏµ·½·¨:   MCU.2000@163.com 
  21          ****************************************************************************/
  22          /*********************************°üº¬Í·ÎÄ¼þ********************************/
  23          #include <reg52.h>
  24          #include <intrins.h>
  25          #define uchar unsigned char
  26          /*********************************¶Ë¿Ú¶¨Òå**********************************/
  27          sbit DS1302_CLK = P1^0;
  28          sbit DS1302_IO = P1^1;
  29          sbit DS1302_RST = P1^2;
  30          
  31          /*******************************¹²ÑôLED¶ÎÂë±í*******************************/
  32          uchar code LED_TAB[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
  33          
  34          /******************************¶¨ÒåÈ«¾Ö±äÁ¿*********************************/
  35          uchar second,minute,hour,week,day,month,year;   
  36          uchar time[]={0x09,0x08,0x15,0x03,0x12,0x12,0x00}; //³õÊ¼Ê±¼äÊý×é
  37          
  38          /****************************************************************************
  39          º¯Êý¹¦ÄÜ:ÊýÂë¹ÜÉ¨ÃèÑÓÊ±×Ó³ÌÐò
  40          Èë¿Ú²ÎÊý:
  41          ³ö¿Ú²ÎÊý:
  42          ****************************************************************************/
  43          void delay1(void)
  44          {
  45   1           int k;
  46   1           for(k=0;k<400;k++);
  47   1      }
  48          
  49          /****************************************************************************
  50          º¯Êý¹¦ÄÜ:ÊýÂë¹ÜÏÔÊ¾×Ó³ÌÐò
  51          Èë¿Ú²ÎÊý:k
  52          ³ö¿Ú²ÎÊý:
  53          ****************************************************************************/
  54          void display(void)
  55          {
C51 COMPILER V9.00   DS1302Ê±_ÓÐ¾Æ¬ÊµÑé2                                                   01/01/2003 18:07:22 PAGE 2   

  56   1           P2=0x01;
  57   1           P0=LED_TAB[minute/16];
  58   1           delay1();
  59   1      
  60   1           P2=0x02;
  61   1           P0=LED_TAB[minute%16] & 0X7F;
  62   1           delay1();
  63   1      
  64   1           P2=0x04;
  65   1           P0=LED_TAB[second/16];
  66   1           delay1();
  67   1      
  68   1           P2=0x08;
  69   1           P0=LED_TAB[second%16];
  70   1           delay1();
  71   1      }
  72          
  73          /*****************************************************************************
  74          º¯Êý¹¦ÄÜ:ÏòDS1302ËÍÒ»×Ö½ÚÊý¾Ý×Ó³ÌÐò
  75          Èë¿Ú²ÎÊý:
  76          ³ö¿Ú²ÎÊý:
  77          *****************************************************************************/
  78          void InputByte(uchar byte1)
  79          {
  80   1           char i;
  81   1           for(i=8;i>0;i--)
  82   1           {
  83   2           DS1302_IO=(bit)(byte1&0x01);
  84   2           DS1302_CLK=1;
  85   2           _nop_();
  86   2           DS1302_CLK=0;
  87   2           byte1>>=1;
  88   2           }
  89   1           return;
  90   1      }
  91          
  92          /*****************************************************************************
  93          º¯Êý¹¦ÄÜ:¶ÁDS1302Ò»¸ö×Ö½Ú×Ó³ÌÐò
  94          Èë¿Ú²ÎÊý:
  95          ³ö¿Ú²ÎÊý:
  96          *****************************************************************************/
  97          uchar outputbyte(void) 
  98          {
  99   1            uchar i;
 100   1            uchar ucdat=0;
 101   1            for(i=8;i>0;i--)
 102   1            {
 103   2            DS1302_IO=1;
 104   2            ucdat>>=1;
 105   2            if(DS1302_IO)ucdat|=0x80;
 106   2            DS1302_CLK=1;
 107   2            _nop_();
 108   2            DS1302_CLK=0;
 109   2            }
 110   1            return(ucdat);
 111   1      }
 112          
 113          /*****************************************************************************
 114          º¯Êý¹¦ÄÜ:ÏòDS1302Ä³µØÖ·Ð´Ò»×Ö½ÚÊý¾Ý×Ó³ÌÐò
 115          Èë¿Ú²ÎÊý:addr,TDat
 116          ³ö¿Ú²ÎÊý:
 117          *****************************************************************************/
C51 COMPILER V9.00   DS1302Ê±_ÓÐ¾Æ¬ÊµÑé2                                                   01/01/2003 18:07:22 PAGE 3   

 118          void write_ds1302(uchar addr,uchar TDat)
 119          {
 120   1           DS1302_RST=0;
 121   1           _nop_();
 122   1           DS1302_CLK=0;
 123   1           _nop_();
 124   1           DS1302_RST=1;
 125   1           InputByte(addr);
 126   1           _nop_();
 127   1           InputByte(TDat);
 128   1           DS1302_CLK=1;
 129   1           _nop_();
 130   1           DS1302_RST=0;
 131   1      }
 132          
 133          /*****************************************************************************
 134          º¯Êý¹¦ÄÜ:¶ÁDS1302µØÖ·×Ó³ÌÐò
 135          Èë¿Ú²ÎÊý:add
 136          ³ö¿Ú²ÎÊý:timedata
 137          *****************************************************************************/
 138          uchar read_ds1302(uchar addr)
 139          {
 140   1            uchar timedata;
 141   1            DS1302_RST=0;
 142   1            _nop_();
 143   1            DS1302_CLK=0;
 144   1            _nop_();
 145   1            DS1302_RST=1;
 146   1            InputByte(addr);
 147   1            timedata=OutputByte();
*** WARNING C206 IN LINE 147 OF DS1302Ê±ÖÓÐ¾Æ¬ÊµÑé2.C: 'OutputByte': missing function-prototype
 148   1            DS1302_CLK=1;
 149   1            _nop_();
 150   1            DS1302_RST=0;
 151   1            return(timedata);
 152   1      }
 153          
 154          /*****************************************************************************
 155          º¯Êý¹¦ÄÜ:³õÊ¼»¯DS1302×Ó³ÌÐò
 156          Èë¿Ú²ÎÊý:time[](È«¾Ö±äÁ¿)
 157          ³ö¿Ú²ÎÊý:
 158          *****************************************************************************/
 159          void initial_ds1302()
 160          {
 161   1           write_ds1302(0x8e,0x00);      //Ð´±£»¤¼Ä´æÆ÷£¬ÔÚ¶ÔÊ±ÖÓ»òRAMÐ´Ç°WPÒ»¶¨ÒªÎª0
 162   1           write_ds1302(0x8c,time[0]);   //Äê
 163   1           write_ds1302(0x88,time[1]);   //ÔÂ
 164   1           write_ds1302(0x86,time[2]);   //ÈÕ
 165   1           write_ds1302(0x8A,time[3]);   //ÐÇÆÚ
 166   1           write_ds1302(0x84,time[4]);   //Ê±
 167   1           write_ds1302(0x82,time[5]);   //·Ö
 168   1           write_ds1302(0x80,time[6]);   //Ãë
 169   1           write_ds1302(0x8e,0x80);      //Ð´±£»¤¼Ä´æÆ÷
 170   1      }
 171          
 172          /*****************************************************************************
 173          º¯Êý¹¦ÄÜ:¶ÁDS1302Ê±¼ä×Ó³ÌÐò
 174          Èë¿Ú²ÎÊý:
 175          ³ö¿Ú²ÎÊý:È«¾Ö±äÁ¿(second,minute,hour,week,day,month,year)
 176          *****************************************************************************/
 177          void read_time()
 178          {
C51 COMPILER V9.00   DS1302Ê±_ÓÐ¾Æ¬ÊµÑé2                                                   01/01/2003 18:07:22 PAGE 4   

 179   1           second=read_ds1302(0x81);   //Ãë¼Ä´æÆ÷
 180   1           minute=read_ds1302(0x83);   //·Ö
 181   1           hour=read_ds1302(0x85);     //Ê±
 182   1           week=read_ds1302(0x8B);     //ÐÇÆÚ
 183   1           day=read_ds1302(0x87);      //ÈÕ
 184   1           month=read_ds1302(0x89);    //ÔÂ
 185   1           year=read_ds1302(0x8d);     //Äê
 186   1      }
 187          
 188          /*****************************************************************************
 189          º¯Êý¹¦ÄÜ:Ö÷³ÌÐò
 190          Èë¿Ú²ÎÊý:
 191          ³ö¿Ú²ÎÊý:
 192          *****************************************************************************/
 193          void main(void)
 194          {
 195   1           initial_ds1302();     //³õÊ¼»¯DS1302
 196   1           while(1)
 197   1           {
 198   2           read_time();          //¶ÁÈ¡Ê±¼ä
 199   2           display();            //ÏÔÊ¾Ê±¼ä
 200   2           }
 201   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    283    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
